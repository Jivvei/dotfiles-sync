# ===================================================================
# TMUX é…ç½®æ–‡ä»¶ - å…¼å®¹æ€§ä¼˜åŒ–ç‰ˆæœ¬
# ===================================================================

# ===================================================================
# åŸºç¡€è®¾ç½® - ä½¿ç”¨æœ€å…¼å®¹çš„ç»ˆç«¯ç±»å‹
# ===================================================================

# å¼ºåˆ¶è®¾ç½®é»˜è®¤ shell ä¸º fish
set -g default-shell /usr/bin/fish
set -g default-command /usr/bin/fish

# è®¾ç½®é»˜è®¤ç»ˆç«¯æ¨¡å¼ï¼ˆä½¿ç”¨æœ€å…¼å®¹çš„ç±»å‹ï¼‰
set -g default-terminal "screen-256color"

# åªåœ¨æ”¯æŒçš„ç»ˆç«¯ä¸Šå¯ç”¨çœŸå½©è‰²
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",alacritty:Tc"
set -ga terminal-overrides ",xterm*:Tc"

# è®¾ç½®è½¬ä¹‰é”®å»¶è¿Ÿ
set -sg escape-time 0

# å¯ç”¨ç„¦ç‚¹äº‹ä»¶
set -g focus-events on

# ===================================================================
# ä¼šè¯å’Œçª—å£è®¾ç½®
# ===================================================================

# è®¾ç½®çª—æ ¼å’Œçª—å£ç¼–å·ä»1å¼€å§‹
set -g base-index 1
set -g pane-base-index 1

# è‡ªåŠ¨é‡æ–°ç¼–å·çª—å£
set -g renumber-windows on

# è®¾ç½®å†å²è®°å½•
set -g history-limit 500010

# å¯ç”¨é¼ æ ‡æ”¯æŒï¼ˆå¢å¼ºç‰ˆï¼‰
set -g mouse on

# é¼ æ ‡æ‹–æ‹½è°ƒæ•´çª—æ ¼å¤§å°
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M

# åŒå‡»é€‰æ‹©å•è¯ï¼Œä¸‰å‡»é€‰æ‹©è¡Œ
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send -X select-word \; run-shell "sleep .5s" \; send -X copy-pipe-and-cancel "xclip -i -sel clipboard"
bind -T copy-mode-vi TripleClick1Pane select-pane \; send -X select-line \; run-shell "sleep .5s" \; send -X copy-pipe-and-cancel "xclip -i -sel clipboard"

# ä¸­é”®ç²˜è´´
bind -n MouseUp2Pane run "tmux set-buffer \"$(xclip -o -sel clipboard)\"; tmux paste-buffer"

# ===================================================================
# çª—æ ¼æ“ä½œ - å‚ç›´å’Œæ°´å¹³åˆ†å‰²
# ===================================================================

# å‚ç›´åˆ†å‰² - ä½¿ç”¨ | é”®æ›´ç›´è§‚
bind | split-window -h -c "#{pane_current_path}"
bind '\' split-window -h -c "#{pane_current_path}"

# æ°´å¹³åˆ†å‰² - ä½¿ç”¨ - é”®æ›´ç›´è§‚  
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# å¿«é€Ÿåˆ›å»ºæ–°çª—å£ï¼ˆä¿æŒå½“å‰è·¯å¾„ï¼‰
bind c new-window -c "#{pane_current_path}"

# ===================================================================
# çª—æ ¼å¯¼èˆª - Vim é£æ ¼é”®ä½
# ===================================================================

# çª—æ ¼å¯¼èˆªï¼ˆä¿ç•™åŸæœ‰åŠŸèƒ½ï¼‰
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ä½¿ç”¨ç®­å¤´é”®ä¹Ÿå¯ä»¥å¯¼èˆªï¼ˆæ›´ç›´è§‚ï¼‰
bind Left select-pane -L
bind Down select-pane -D
bind Up select-pane -U
bind Right select-pane -R

# çª—æ ¼å¤§å°è°ƒæ•´
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ä½¿ç”¨ç®­å¤´é”®è°ƒæ•´å¤§å°ï¼ˆæŒ‰ä½Shiftï¼‰
bind -r S-Left resize-pane -L 2
bind -r S-Down resize-pane -D 1
bind -r S-Up resize-pane -U 1
bind -r S-Right resize-pane -R 2

# ===================================================================
# å¤åˆ¶æ¨¡å¼è®¾ç½®
# ===================================================================

# è¿›å…¥å¤åˆ¶æ¨¡å¼
bind v copy-mode

# Vi æ¨¡å¼é”®ä½ç»‘å®š
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# ===================================================================
# å¿«æ·é”®é…ç½®
# ===================================================================

# å¿«é€Ÿé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
bind r source-file ~/.tmux.conf \; display-message "âœ… é…ç½®å·²é‡æ–°åŠ è½½!"

# æ˜¾ç¤ºå¿«æ·é”®æç¤º - æŒ‰ Ctrl+b åæŒ‰ ? æŸ¥çœ‹æ‰€æœ‰å¿«æ·é”®
bind ? list-keys

# æ˜¾ç¤ºå¸¸ç”¨æ“ä½œæç¤º - æŒ‰ Ctrl+b åæŒ‰ F1 æ˜¾ç¤ºå¸®åŠ©
bind F1 display-popup -E "echo 'ğŸ”¤ tmux å¢å¼ºå¿«æ·é”®æç¤º
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ çª—æ ¼åˆ†å‰²:
  |/\\\\    å‚ç›´åˆ†å‰²    \"/%    æ°´å¹³åˆ†å‰²

ğŸ§­ çª—æ ¼å¯¼èˆª:
  h/â†      å‘å·¦        j/â†“     å‘ä¸‹  
  k/â†‘      å‘ä¸Š        l/â†’     å‘å³

ğŸ“ çª—æ ¼è°ƒæ•´:
  H        å‘å·¦æ‰©å±•    J       å‘ä¸‹æ‰©å±•
  K        å‘ä¸Šæ‰©å±•    L       å‘å³æ‰©å±•
  Shift+æ–¹å‘é”®         ç²¾ç»†è°ƒæ•´

ğŸ–¥ï¸  çª—å£ç®¡ç†:
  c        æ–°å»ºçª—å£    N       å‘½åæ–°çª—å£
  ,        é‡å‘½åçª—å£  Tab     ä¸Šä¸€ä¸ªçª—å£
  Alt+1-9  å¿«é€Ÿåˆ‡æ¢    s       é€‰æ‹©ä¼šè¯

ğŸ›ï¸  å¸ƒå±€åˆ‡æ¢:
  Space    ä¸‹ä¸€å¸ƒå±€    Alt+1   æ°´å¹³å‡åˆ†
  Alt+2    å‚ç›´å‡åˆ†    Alt+3   ä¸»çª—æ ¼æ°´å¹³
  Alt+4    ä¸»çª—æ ¼å‚ç›´  Alt+5   å¹³é“º

ğŸ”§ å®ç”¨åŠŸèƒ½:
  q        æ˜¾ç¤ºç¼–å·    i       çª—æ ¼ä¿¡æ¯
  z        æœ€å¤§åŒ–      x       å…³é—­çª—æ ¼
  S        åŒæ­¥è¾“å…¥    r       é‡æ–°åŠ è½½
  ?        å®Œæ•´å¸®åŠ©    F1      æ­¤å¸®åŠ©

æŒ‰ä»»æ„é”®å…³é—­...'; read"

# åœ¨çŠ¶æ€æ æ˜¾ç¤ºå‰ç¼€é”®çŠ¶æ€ï¼ˆè¿™ä¸ªé…ç½®ä¼šåœ¨åé¢çš„çŠ¶æ€æ éƒ¨åˆ†ç»Ÿä¸€è®¾ç½®ï¼‰

# åŒæ­¥æ‰€æœ‰çª—æ ¼è¾“å…¥ï¼ˆæ”¹è¿›ç‰ˆï¼‰
bind S setw synchronize-panes \; display-message "#{?synchronize-panes,ğŸ”— çª—æ ¼è¾“å…¥å·²åŒæ­¥,âŒ çª—æ ¼è¾“å…¥å·²å–æ¶ˆåŒæ­¥}"

# å¿«é€Ÿä¼šè¯ç®¡ç†
bind s choose-tree -Zs  # é€‰æ‹©ä¼šè¯
bind w choose-tree -Zw  # é€‰æ‹©çª—å£

# å¿«é€Ÿçª—å£åˆ‡æ¢ï¼ˆAlt + æ•°å­—ï¼‰
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# å¿«é€Ÿçª—æ ¼æ“ä½œ
bind q display-panes -d 0  # æ˜¾ç¤ºçª—æ ¼ç¼–å·ï¼ˆä¸è‡ªåŠ¨æ¶ˆå¤±ï¼‰
bind Space next-layout      # åˆ‡æ¢å¸ƒå±€
bind o rotate-window        # æ—‹è½¬çª—æ ¼

# å¤åˆ¶åˆ°ç³»ç»Ÿå‰ªè´´æ¿ï¼ˆæ”¹è¿›ç‰ˆï¼‰
bind C-c run "tmux save-buffer - | xclip -i -sel clipboard"
bind C-v run "tmux set-buffer \"$(xclip -o -sel clipboard)\"; tmux paste-buffer"

# å¿«é€Ÿåˆ†å‰²çª—æ ¼åˆ°ç‰¹å®šç›®å½•
bind '"' split-window -v -c "#{pane_current_path}"
bind '%' split-window -h -c "#{pane_current_path}"

# å¢å¼ºçš„çª—æ ¼æ“ä½œ
bind m command-prompt -p "ç§»åŠ¨çª—æ ¼åˆ°:" "move-pane -t %%"
bind M command-prompt -p "æ ‡è®°çª—æ ¼ä¸º:" "select-pane -m"
bind P paste-buffer
bind b list-buffers
bind p choose-buffer

# å¿«é€Ÿå¸ƒå±€åˆ‡æ¢
bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

# å¿«é€Ÿé‡å‘½å
bind , command-prompt -I "#W" "rename-window '%%'"
bind '$' command-prompt -I "#S" "rename-session '%%'"

# å¿«é€Ÿæ–°å»ºå¸¦åç§°çš„çª—å£å’Œä¼šè¯
bind N command-prompt -p "çª—å£åç§°:" "new-window -n '%%'"
bind C-s command-prompt -p "ä¼šè¯åç§°:" "new-session -s '%%'"

# çª—æ ¼ä¿¡æ¯æ˜¾ç¤º
bind i display-message "çª—æ ¼: #{pane_index} | å¤§å°: #{pane_width}x#{pane_height} | è·¯å¾„: #{pane_current_path}"

# SSHä¸»æœºä¿¡æ¯å¿«é€Ÿæ˜¾ç¤ºï¼ˆå†…ç½®ç‰ˆæœ¬ï¼‰
bind I display-popup -w 70 -h 20 -E '
if [ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ] || [ -n "$SSH_CONNECTION" ]; then
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ğŸ”— SSH è¿æ¥ä¿¡æ¯"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  [ -n "$SSH_CONNECTION" ] && echo "ğŸ“± è¿æ¥: $SSH_CONNECTION"
  echo "ğŸ·ï¸  ä¸»æœº: $(hostname -f)"
  echo "ğŸ‘¤ ç”¨æˆ·: $(whoami)"
  echo "ğŸ“¡ IP: $(hostname -I | cut -d\" \" -f1)"
  echo "â° æ—¶é—´: $(date)"
else
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ğŸ  æœ¬åœ°è¿æ¥ä¿¡æ¯"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ğŸ·ï¸  ä¸»æœº: $(hostname -f)"
  echo "ğŸ‘¤ ç”¨æˆ·: $(whoami)"
  echo "ğŸ“¡ IP: $(hostname -I | cut -d\" \" -f1)"
  echo "ğŸŒ ç½‘å…³: $(ip route | grep default | cut -d\" \" -f3)"
fi
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
read -p "æŒ‰ä»»æ„é”®å…³é—­..."
'

# å¿«é€Ÿåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªçª—å£å’Œä¼šè¯
bind Tab last-window
bind BTab switch-client -l

# é«˜çº§å‘½ä»¤é¢æ¿ï¼ˆæ”¯æŒç®­å¤´é”®é€‰æ‹©ï¼‰
bind C-p display-menu -T "ğŸ›ï¸ tmux å‘½ä»¤é¢æ¿" -x C -y C \
    "ğŸ“ æ–°å»ºçª—å£" 1 "new-window" \
    "ğŸ”„ é‡å‘½åçª—å£" 2 "command-prompt -I '#W' 'rename-window %%'" \
    "ğŸ“‹ é€‰æ‹©ä¼šè¯" 3 "choose-tree -Zs" \
    "ğŸ–¥ï¸ æ–°å»ºä¼šè¯" 4 "command-prompt -p 'ä¼šè¯åç§°:' 'new-session -s %%'" \
    "ğŸ”— åˆ‡æ¢åŒæ­¥" 5 "setw synchronize-panes" \
    "ğŸ“ å‡åˆ†å¸ƒå±€" 6 "select-layout tiled" \
    "ğŸ” æœç´¢çª—å£" 7 "choose-tree -Zw" \
    "ğŸ’¾ æ˜¾ç¤ºå¸ƒå±€" 8 "display-message 'å¸ƒå±€: #{window_layout}'" \
    "ğŸ“Š ç³»ç»Ÿä¿¡æ¯" 9 "display-popup -E 'htop -n 1 | head -20; echo; read -p \"æŒ‰ä»»æ„é”®å…³é—­...\"'" \
    "âŒ å…³é—­é¢æ¿" 0 ""

# å¿«é€Ÿå‘½ä»¤æ‰§è¡Œ
bind ! command-prompt -p "åœ¨æ‰€æœ‰çª—æ ¼æ‰§è¡Œ:" "run-shell 'for _pane in \$(tmux list-panes -F \"#{pane_id}\"); do tmux send-keys -t \$_pane \"%%\" Enter; done'"

# ç»ˆç«¯å·¥å…·é¢æ¿
bind t display-menu -T "ğŸ–¥ï¸ ç»ˆç«¯å·¥å…·" -x C -y C \
    "ğŸ“Š ç³»ç»Ÿç›‘æ§" 1 "new-window 'htop'" \
    "ğŸ“ æ–‡ä»¶ç®¡ç†" 2 "new-window 'ranger 2>/dev/null || ls -la'" \
    "ğŸŒ ç½‘ç»œçŠ¶æ€" 3 "display-popup -E 'ss -tulpn && read'" \
    "ğŸ” è¿›ç¨‹æŸ¥çœ‹" 4 "display-popup -E 'ps aux | head -20 && read'" \
    "ğŸ“‹ å‰ªè´´æ¿" 5 "display-popup -E 'xclip -o && read'" \
    "âš™ï¸ ç³»ç»Ÿä¿¡æ¯" 6 "display-popup -E 'uname -a && uptime && read'"

# æ‰‹åŠ¨åˆ·æ–°çŠ¶æ€æ ï¼ˆç”¨äºSSHç¯å¢ƒå˜åŒ–åï¼‰
bind r refresh-client

# ç³»ç»Ÿå·¥å…·å¿«æ·é”®
bind S setw synchronize-panes \; display-message "#{?synchronize-panes,ğŸ”— çª—æ ¼è¾“å…¥å·²åŒæ­¥,âŒ çª—æ ¼è¾“å…¥å·²å–æ¶ˆåŒæ­¥}"

# ç½‘ç»œç®¡ç†é¢æ¿ï¼ˆæ”¯æŒç®­å¤´é”®é€‰æ‹©ï¼‰
bind C-h display-menu -T "ğŸŒ ç½‘ç»œå·¥å…·" -x C -y C \
    "ğŸ“Š ç½‘ç»œçŠ¶æ€" 1 "display-popup -E 'ss -tulpn && read'" \
    "ğŸ“± è¿æ¥å†å²" 2 "display-popup -E 'last -a | head -20 && read'" \
    "ğŸ” SSHå¯†é’¥ä¿¡æ¯" 3 "display-popup -E 'ls -la ~/.ssh/ && echo && ssh-add -l 2>/dev/null || echo \"æ²¡æœ‰åŠ è½½çš„å¯†é’¥\" && read'" \
    "ğŸŒ ç½‘ç»œè¯Šæ–­" 4 "display-popup -E 'ping -c 3 8.8.8.8 && echo && traceroute -m 5 8.8.8.8 2>/dev/null | head -10 && read'" \
    "ğŸ“¡ ç«¯å£ç›‘å¬" 5 "display-popup -E 'ss -tulpn | grep LISTEN && read'" \
    "âš™ï¸ SSHé…ç½®" 6 "split-window -h 'vim ~/.ssh/config'" \
    "ğŸ”„ åˆ·æ–°çŠ¶æ€æ " 7 "refresh-client"

# æ—¥å¿—æŸ¥çœ‹å™¨
bind L display-menu -T "ğŸ“œ æ—¥å¿—æŸ¥çœ‹" -x C -y C \
    "ğŸ“Š ç³»ç»Ÿæ—¥å¿—" 1 "display-popup -E 'journalctl -n 50 --no-pager && read'" \
    "ğŸ” å†…æ ¸æ—¥å¿—" 2 "display-popup -E 'dmesg | tail -30 && read'" \
    "ğŸŒ SSHæ—¥å¿—" 3 "display-popup -E 'journalctl -u ssh -n 20 --no-pager && read'" \
    "ğŸ³ Dockeræ—¥å¿—" 4 "display-popup -E 'docker logs \$(docker ps -q) 2>/dev/null | tail -20 && read'" \
    "ğŸ“ˆ å®æ—¶æ—¥å¿—" 5 "new-window 'journalctl -f'" \
    "âš ï¸ é”™è¯¯æ—¥å¿—" 6 "display-popup -E 'journalctl -p err -n 20 --no-pager && read'"

# å¿«é€Ÿé…ç½®ç¼–è¾‘
bind C-e split-window -h "cd ~/.tmux && \$EDITOR ~/.tmux.conf"

# è¿›ç¨‹ç®¡ç†å™¨
bind T display-menu -T "ğŸ”„ è¿›ç¨‹ç®¡ç†" -x C -y C \
    "ğŸ“Š è¿›ç¨‹åˆ—è¡¨" 1 "display-popup -E 'ps aux --sort=-%cpu | head -20 && read'" \
    "ğŸ’¾ å†…å­˜å ç”¨" 2 "display-popup -E 'ps aux --sort=-%mem | head -20 && read'" \
    "ğŸ” æœç´¢è¿›ç¨‹" 3 "command-prompt -p 'æœç´¢è¿›ç¨‹:' 'display-popup -E \"ps aux | grep %% && read\"'" \
    "âš¡ ç³»ç»Ÿç›‘æ§" 4 "new-window 'htop'" \
    "ğŸŒ ç½‘ç»œè¿æ¥" 5 "display-popup -E 'ss -tulpn && read'" \
    "ğŸ”§ æœåŠ¡çŠ¶æ€" 6 "display-popup -E 'systemctl list-units --failed && read'"

# ç½‘ç»œç›‘æ§
bind C-n display-menu -T "ğŸŒ ç½‘ç»œç›‘æ§" -x C -y C \
    "ğŸ“Š ç½‘ç»œçŠ¶æ€" 1 "display-popup -E 'ss -tulpn && read'" \
    "ğŸ” è¿æ¥ç»Ÿè®¡" 2 "display-popup -E 'ss -s && read'" \
    "ğŸ“ˆ ç½‘ç»œæ¥å£" 3 "display-popup -E 'ip addr show && read'" \
    "ğŸŒ è·¯ç”±è¡¨" 4 "display-popup -E 'ip route && read'" \
    "ğŸ”§ ç½‘ç»œè¯Šæ–­" 5 "display-popup -E 'ping -c 3 8.8.8.8 && read'" \
    "ğŸ“¡ å®æ—¶ç›‘æ§" 6 "new-window 'watch -n 1 ss -tulpn'"

# Docker é›†æˆ
bind D display-menu -T "ğŸ³ Docker ç®¡ç†" -x C -y C \
    "ğŸ“Š å®¹å™¨åˆ—è¡¨" 1 "display-popup -E 'docker ps -a && read'" \
    "ğŸ“ˆ å®¹å™¨ç»Ÿè®¡" 2 "display-popup -E 'docker stats --no-stream && read'" \
    "ğŸŒ é•œåƒåˆ—è¡¨" 3 "display-popup -E 'docker images && read'" \
    "ğŸ” å®¹å™¨æ—¥å¿—" 4 "command-prompt -p 'å®¹å™¨å:' 'display-popup -E \"docker logs %% && read\"'" \
    "âš¡ ç³»ç»Ÿä¿¡æ¯" 5 "display-popup -E 'docker system df && docker system info && read'" \
    "ğŸ”§ æ¸…ç†ç³»ç»Ÿ" 6 "display-popup -E 'docker system prune -f && read'"

# å¿«é€Ÿæœç´¢åŠŸèƒ½
bind / copy-mode \; command-prompt -i -I "#{pane_search_string}" -p "(search down)" "send -X search-forward-incremental \"%%%\""
bind ? copy-mode \; command-prompt -i -I "#{pane_search_string}" -p "(search up)" "send -X search-backward-incremental \"%%%\""

# ===================================================================
# çŠ¶æ€æ é…ç½® - ç®€åŒ–ç‰ˆ
# ===================================================================

# çŠ¶æ€æ åŸºç¡€è®¾ç½®
set -g status on
set -g status-interval 5

# ç¡®ä¿SSHç¯å¢ƒå˜é‡åœ¨tmuxä¸­å¯ç”¨
set -g update-environment "DISPLAY SSH_ASKPASS SSH_AGENT_PID SSH_CONNECTION SSH_TTY WINDOWID XAUTHORITY"
set -g status-position bottom
set -g status-justify left

# çŠ¶æ€æ é¢œè‰² - ç®€åŒ–é…è‰²é¿å…å…¼å®¹æ€§é—®é¢˜
set -g status-style 'bg=colour235,fg=colour136'

# å·¦ä¾§çŠ¶æ€æ  - æ˜¾ç¤ºæ›´å¤šä¿¡æ¯
set -g status-left-length 200
set -g status-left '#[bg=colour166,fg=colour235,bold] #S #[bg=colour235,fg=colour166]#{?client_prefix, ğŸ”¤ [ç­‰å¾…å‘½ä»¤] ,}#{?synchronize-panes, ğŸ”— [åŒæ­¥] ,} #[bg=colour240,fg=colour136] #I:#P '

# å³ä¾§çŠ¶æ€æ  - ç®€åŒ–ç³»ç»Ÿä¿¡æ¯æ˜¾ç¤º
set -g status-right-length 200
set -g status-right '#[bg=colour235,fg=colour136] #(/home/Jiwei/.tmux/scripts/cpu_usage.sh) #[bg=colour235,fg=colour136] #(/home/Jiwei/.tmux/scripts/memory_usage.sh) #[bg=colour136,fg=colour235,bold] %H:%M #[bg=colour235,fg=colour166] #[bg=colour166,fg=colour235,bold] %d-%b-%y #[bg=colour235,fg=colour136] ğŸ–¥ï¸ #{session_windows}W '

# çª—å£çŠ¶æ€æ æ ¼å¼
setw -g window-status-format '#[bg=colour240,fg=colour136] #I:#W '
setw -g window-status-current-format '#[bg=colour166,fg=colour235,bold] #I:#W '

# çª—æ ¼è¾¹æ¡†é¢œè‰²
set -g pane-border-style 'fg=colour240'
set -g pane-active-border-style 'fg=colour166'

# æ¶ˆæ¯æ ·å¼
set -g message-style 'bg=colour166,fg=colour235,bold'
set -g message-command-style 'bg=colour136,fg=colour235,bold'

# ===================================================================
# é«˜çº§åŠŸèƒ½
# ===================================================================

# è‡ªåŠ¨è®¾ç½®çª—å£æ ‡é¢˜ï¼ˆSSHæ„ŸçŸ¥ï¼‰
setw -g automatic-rename on
set -g set-titles on
set -g set-titles-string '#{?SSH_CONNECTION,ğŸŒ SSH: #{host_short},ğŸ  Local: #{host_short}} - #{window_name}'

# SSHç¯å¢ƒä¸‹çš„çª—å£æ ‡é¢˜æ ¼å¼
setw -g automatic-rename-format '#{?SSH_CONNECTION,#{host_short}:#{pane_current_command},#{pane_current_command}}'

# æ´»åŠ¨ç›‘æ§
setw -g monitor-activity on
set -g visual-activity off

# æ—¶é’Ÿæ¨¡å¼é¢œè‰²
setw -g clock-mode-colour colour166

# ===================================================================
# é«˜çº§æ’ä»¶å’Œè‡ªåŠ¨åŒ–åŠŸèƒ½
# ===================================================================

# ä¼šè¯ç®¡ç†ï¼ˆç®€åŒ–ç‰ˆï¼‰
bind C-r display-message "ä¼šè¯å¸ƒå±€: #{window_layout}"
bind C-l choose-tree -Zs

# å¿«é€Ÿç¯å¢ƒé¢„è®¾ï¼ˆæ”¯æŒç®­å¤´é”®é€‰æ‹©ï¼‰
bind E display-menu -T "ğŸš€ å¿«é€Ÿç¯å¢ƒ" -x C -y C \
    "ğŸ’» å¼€å‘ç¯å¢ƒ" 1 "rename-window 'DEV' ; split-window -h ; split-window -v" \
    "ğŸ“Š ç›‘æ§ç¯å¢ƒ" 2 "rename-window 'MON' ; new-window 'htop' ; new-window 'journalctl -f'" \
    "ğŸ“œ æ—¥å¿—æŸ¥çœ‹" 3 "rename-window 'LOG' ; new-window 'tail -f /var/log/syslog'" \
    "ğŸŒ ç½‘ç»œå·¥å…·" 4 "rename-window 'NET' ; new-window 'ss -tulpn' ; split-window 'ping 8.8.8.8'" \
    "ğŸ³ Dockerç¯å¢ƒ" 5 "rename-window 'DOCKER' ; new-window 'docker ps' ; split-window 'docker stats'" \
    "ğŸ”§ ç³»ç»Ÿç»´æŠ¤" 6 "rename-window 'SYS' ; new-window 'top' ; split-window 'iotop'" \
    "ğŸ“ æ–‡ä»¶ç®¡ç†" 7 "rename-window 'FILES' ; new-window 'ranger'" \
    "ğŸ” æœç´¢å·¥å…·" 8 "rename-window 'SEARCH' ; new-window 'fzf' ; split-window 'ag'"

# ç³»ç»Ÿç›‘æ§é›†æˆï¼ˆæ”¯æŒç®­å¤´é”®é€‰æ‹©ï¼‰
bind M display-menu -T "ğŸ“Š ç³»ç»Ÿç›‘æ§" -x C -y C \
    "ğŸ“ˆ CPUä½¿ç”¨ç‡" 1 "display-popup -E 'htop -d 1'" \
    "ğŸ’¾ å†…å­˜ä½¿ç”¨" 2 "display-popup -E 'free -h && echo && ps aux --sort=-%mem | head -20 && read'" \
    "ğŸ’½ ç£ç›˜ç©ºé—´" 3 "display-popup -E 'df -h && echo && du -sh /* 2>/dev/null | sort -hr | head -10 && read'" \
    "ğŸŒ ç½‘ç»œçŠ¶æ€" 4 "display-popup -E 'ss -tulpn && echo && iftop -t -s 10 2>/dev/null || netstat -i && read'" \
    "âš¡ ç³»ç»Ÿè´Ÿè½½" 5 "display-popup -E 'uptime && echo && w && echo && read'" \
    "ğŸ”„ è¿›ç¨‹ç®¡ç†" 6 "display-popup -E 'ps aux --sort=-%cpu | head -20 && echo && read'" \
    "ğŸ“Š å®Œæ•´ç›‘æ§" 7 "new-window 'htop' ; split-window 'iotop' ; split-window -h 'nethogs'" \
    "ğŸ” æ—¥å¿—æŸ¥çœ‹" 8 "display-popup -E 'journalctl -f --no-pager | head -50 && read'"

# é¡¹ç›®å¿«é€Ÿå¯åŠ¨ï¼ˆæ”¯æŒç®­å¤´é”®é€‰æ‹©ï¼‰
bind P display-menu -T "ğŸš€ é¡¹ç›®å¯åŠ¨" -x C -y C \
    "ğŸ“ åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•" 1 "new-window -c ~/projects" \
    "ğŸŒ Webå¼€å‘ç¯å¢ƒ" 2 "rename-window 'WEB' ; new-window -c ~/projects ; split-window -h 'npm start' ; split-window -v" \
    "ğŸ Pythonç¯å¢ƒ" 3 "rename-window 'PY' ; new-window -c ~/projects ; send-keys 'python3 -m venv venv && source venv/bin/activate' Enter" \
    "ğŸ¦€ Rustç¯å¢ƒ" 4 "rename-window 'RUST' ; new-window -c ~/projects ; send-keys 'cargo new project && cd project' Enter" \
    "â˜• Javaç¯å¢ƒ" 5 "rename-window 'JAVA' ; new-window -c ~/projects ; split-window -h" \
    "ğŸ³ Dockeré¡¹ç›®" 6 "rename-window 'DOCKER' ; new-window -c ~/projects ; send-keys 'docker-compose up' Enter ; split-window 'docker-compose logs -f'" \
    "ğŸ“¦ Node.jsé¡¹ç›®" 7 "rename-window 'NODE' ; new-window -c ~/projects ; send-keys 'npm init -y && npm install' Enter" \
    "ğŸ› ï¸ é€šç”¨å¼€å‘" 8 "rename-window 'DEV' ; new-window -c ~/projects ; split-window -h ; split-window -v 'git status'"

# å¿«é€Ÿç¬”è®°åŠŸèƒ½
bind n display-popup -E "/home/Jiwei/.tmux/scripts/quick_note.sh"

# Git çŠ¶æ€å¿«é€ŸæŸ¥çœ‹ï¼ˆæ”¯æŒç®­å¤´é”®é€‰æ‹©ï¼‰
bind g display-menu -T "ğŸ”§ Git æ“ä½œ" -x C -y C \
    "ğŸ“Š GitçŠ¶æ€" 1 "display-popup -E 'git status && echo && git log --oneline -10 && read'" \
    "ğŸ“ˆ Gitæ—¥å¿—" 2 "display-popup -E 'git log --oneline --graph -20 && read'" \
    "ğŸ” Gitå·®å¼‚" 3 "display-popup -E 'git diff --stat && echo && git diff && read'" \
    "ğŸŒ¿ åˆ†æ”¯ç®¡ç†" 4 "display-popup -E 'git branch -a && echo && read -p \"åˆ‡æ¢åˆ°åˆ†æ”¯: \" branch && git checkout \$branch'" \
    "ğŸ“¥ æ‹‰å–æ›´æ–°" 5 "display-popup -E 'git pull && read'" \
    "ğŸ“¤ æ¨é€ä»£ç " 6 "display-popup -E 'git push && read'" \
    "ğŸ’¾ å¿«é€Ÿæäº¤" 7 "display-popup -E 'git add . && read -p \"æäº¤ä¿¡æ¯: \" msg && git commit -m \"\$msg\"'" \
    "ğŸ”„ åŒæ­¥æ‰€æœ‰" 8 "display-popup -E 'git add . && git commit -m \"Auto commit\" && git pull && git push && read'"

# æ–‡ä»¶ç®¡ç†å™¨
bind f display-menu -T "ğŸ“ æ–‡ä»¶ç®¡ç†" -x C -y C \
    "ğŸ“‚ å½“å‰ç›®å½•" 1 "display-popup -E 'ls -la && read'" \
    "ğŸ” æŸ¥æ‰¾æ–‡ä»¶" 2 "command-prompt -p 'æ–‡ä»¶å:' 'display-popup -E \"find . -name \\\"*%%*\\\" 2>/dev/null && read\"'" \
    "ğŸ“ ç¼–è¾‘æ–‡ä»¶" 3 "command-prompt -p 'æ–‡ä»¶å:' 'split-window -h \"vim %%\"'" \
    "ğŸ—‚ï¸ æ–‡ä»¶æµè§ˆå™¨" 4 "new-window 'ranger 2>/dev/null || ls -la'" \
    "ğŸ“Š ç£ç›˜ä½¿ç”¨" 5 "display-popup -E 'du -sh * 2>/dev/null | sort -hr | head -20 && read'" \
    "ğŸ”§ åˆ›å»ºæ–‡ä»¶" 6 "command-prompt -p 'æ–‡ä»¶å:' 'run-shell \"touch %%\"'" \
    "ğŸ“ åˆ›å»ºç›®å½•" 7 "command-prompt -p 'ç›®å½•å:' 'run-shell \"mkdir -p %%\"'" \
    "ğŸ—‘ï¸ åˆ é™¤æ–‡ä»¶" 8 "command-prompt -p 'æ–‡ä»¶å:' 'run-shell \"rm -i %%\""'
